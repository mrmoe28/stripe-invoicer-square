# Trigger Vercel deployment when push to main doesn't auto-deploy
# Requires: Add your Vercel Deploy Hook URL as repo secret VERCEL_DEPLOY_HOOK_URL
# Create hook: Vercel Project → Settings → Git → Deploy Hooks → Create Hook (e.g. "GitHub Action") → copy URL
# Repo: https://github.com/mrmoe28/stripe-invoicer-square

name: Trigger Vercel deployment

on:
  push:
    branches: [main]
  workflow_dispatch: # Allow manual run from Actions tab

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Vercel deployment
        run: |
          if [ -z "${{ secrets.VERCEL_DEPLOY_HOOK_URL }}" ]; then
            echo "::warning::VERCEL_DEPLOY_HOOK_URL secret not set. Add it in repo Settings → Secrets and variables → Actions."
            exit 0
          fi
          response=$(curl -s -w "\n%{http_code}" -X POST "${{ secrets.VERCEL_DEPLOY_HOOK_URL }}")
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          echo "Response ($http_code): $body"
          if [ "$http_code" -ge 200 ] && [ "$http_code" -lt 300 ]; then
            echo "Vercel deployment triggered successfully."
          else
            echo "::error::Vercel deploy hook returned HTTP $http_code"
            exit 1
          fi
